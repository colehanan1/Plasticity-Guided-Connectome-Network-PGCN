# Data Schema

This document records the artefact formats generated by the connectome cache
and metric pipelines. All coordinates are reported in nanometres and follow
the FlyWire voxel reference frame.

## Cache Artefacts

### `nodes.parquet`

| Column          | Type    | Description                                                     |
|-----------------|---------|-----------------------------------------------------------------|
| `node_id`       | int64   | FlyWire root identifier.                                        |
| `type`          | string  | One of `PN`, `KC`, `MBON`, or `DAN`.                            |
| `glomerulus`    | string? | Glomerulus label for PNs when provided by the cell tables.      |
| `synapse_count` | float64 | Total synapse weight aggregated across incoming and outgoing edges. |
| `x`, `y`, `z`   | float64 | Synapse centroid coordinates (nm).                              |

### `edges.parquet`

| Column           | Type    | Description                                        |
|------------------|---------|----------------------------------------------------|
| `source_id`      | int64   | Upstream node id (PN or KC).                       |
| `target_id`      | int64   | Downstream node id (KC or MBON).                   |
| `synapse_weight` | float64 | Aggregated synapse count/weight.                   |

### `dan_edges.parquet`

| Column           | Type    | Description                                        |
|------------------|---------|----------------------------------------------------|
| `source_id`      | int64   | Dopaminergic neuron id.                            |
| `target_id`      | int64   | KC or MBON target id.                              |
| `synapse_weight` | float64 | Aggregated synapse count/weight.                   |

### `meta.json`

```json
{
  "datastack": "flywire_fafb_production",
  "materialization_version": 783,
  "synapse_table": "<synapse_table_name>",
  "cell_tables": ["<cell_table_1>", "<cell_table_2>"]
}
```

## Metrics Artefacts

| File                            | Description                                                  |
|---------------------------------|--------------------------------------------------------------|
| `kc_overlap.parquet`            | Glomerulus pairwise Jaccard overlaps with KC counts.         |
| `pn_kc_mbon_paths.parquet`      | Two-hop PN→KC→MBON path weights and KC counts.               |
| `weighted_centrality.parquet`   | Weighted in/out degree and betweenness per node.             |
| `dan_valence.parquet`           | PAM/PPL1/DAN-other valence classifications.                  |
| `metrics_meta.json`             | Row counts for sanity checking downstream analyses.          |

All parquet datasets are encoded with Apache Arrow metadata to preserve
column types. JSON metadata is formatted with sorted keys for reproducibility.
